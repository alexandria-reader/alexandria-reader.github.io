<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us>
<head>
<meta name=generator content="Hugo 0.91.2">
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Alexandria - Design Notes</title>
<link rel="shortcut icon" href=favicon.ico type=image/x-icon>
<link href="https://fonts.googleapis.com/css?family=Dosis:wght@200;300;400;500;600;700;800&display=swap" rel=stylesheet>
<link rel=stylesheet href=/css/styles.css>
<link href=/index.xml rel=alternate type=application/rss+xml title=Alexandria>
</head>
<body>
<div class="sidebar sidebar-grey">
<div class=navigation>
<div>
<img src=/images/logo-light.png alt="Alexandria logo">
<p style=font-size:smaller>Learn languages by translating texts</p>
</div>
<h1 class=site-title><a href=/>Alexandria</a></h1>
<nav class=internal>
<ul>
<li>
<a href=#introduction>Introduction</a>
</li>
<li>
<a href=#decisions>Technical decisions</a>
</li>
<li>
<a href=#database-api>Database and API design</a>
</li>
<li>
<a href=#challenges>Challenges and Solutions</a>
</li>
<li>
<a href=#team>Team</a>
</li>
<li>
<a href=#references>References</a>
</li>
</ul>
</nav>
<nav class=external>
<div class=external-title>Check out Alexandria:</div>
<ul id=shortcuts>
<li>
<a href=https://alexandria-reader.netlify.app target=_blank rel=noopener>Use the app</a>
</li>
<li>
<a href=https://github.com/alexandria-reader/ target=_blank rel=noopener>Visit Alexandria on Github</a>
</li>
</ul>
</nav>
</div>
</div>
<div class=content>
<section class=page id=introduction>
<h1>
<a href=#introduction>Introduction</a>
</h1>
<div class=content>
<p>Why is language acquisition so evasive for the majority of language learners? Why has decades of grammar rules, repetition drills, and computer-assisted learning shown only limited success? In recent years, research surrounding both second language acquisition as well as literacy has shown that language acquisition occurs when we comprehend messages alongside its surrounding context 1. More specifically, the &ldquo;input hypothesis&rdquo; states that we acquire language in one way and one way only: when we understand messages, and when we obtain comprehensive input.</p>
<p>With this very specific language learning need in mind, a number of web applications has been created in recent years. Language learning enthusiasts have embraced those platforms to supplment their language learning journey.</p>
<p>Despite a choice of platforms that range from open source software to paid software, there are shortcomings. The language learning enthusiast in our team has identified a number of weaknesses that Alexandria seeks to address.</p>
<h3 id=competitor-analysis>Competitor analysis</h3>
<p>Current &ldquo;learning with text&rdquo; software applications fall under two broad groups.</p>
<p>One group includes long-standing open source projects that are well received but sparsely maintained, or newer free applications that started with a bang, but were quickly forgotten and subsequently neglected.</p>
<p>The second group of applications are commercial solutions that address the goal of language learning with text, but suffer from feature bloat, lack of user friendliness, or mobile performance issues.</p>
<p>Alexandria would like to become the go-to solution for language learning enthusiasts. Through keeping the product free and open source, we aspire to continue developmenting product features that are crucial to language learners, while maintaining a joyful user experience based on the latest technological offerings.</p>
<table>
<thead>
<tr>
<th></th>
<th>Existing Free/Open Source Software</th>
<th>Alexandria</th>
<th>Commerical Products</th>
</tr>
</thead>
<tbody>
<tr>
<td>Interactive front-end user experience</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>Open Source</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>Ongoing Development</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>Mobile First</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>Responsiveness to Community Input</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody>
</table>
<p>Our main objectives were to create a modern, fast, open source webapp with a mobile first interface, allowing users to quickly and easily get learning without having to stuggle with the interface or wait for eveything to load.</p>
</div>
</section>
<section class=page id=decisions>
<h1>
<a href=#decisions>Technical decisions</a>
</h1>
<div class=content>
<p>How we decided on technologies we used.</p>
<h3 id=typescript-vs-javascript>TypeScript vs JavaScript</h3>
<p>Before we started developing Alexandria, none of us had any real experience using TypeScript, whereas we all had a solid foundation in JavaScript.
Yet after doing a lot of research, we decided to use TypeScript in our project. Why?</p>
<h4 id=static-typing>Static typing</h4>
<p>One of the main reasons is the static typing that is a core part of TypeScript. In JavaScript, an object can have whatever properties you want, and you can add
and remove them as you see fit. In TypeScript, types are static, meaning that once an object&rsquo;s type is declared, it does not change its type and can
only take certain values.</p>
<p>An example of this is a <code>UserWord</code> which is how we chose to represent the words that a user saved to the database by adding a translation and status.</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#00a8c8>type</span> <span style=color:#75af00>UserWord</span> <span style=color:#f92672>=</span> <span style=color:#111>{</span>
  <span style=color:#75af00>id?</span>: <span style=color:#00a8c8>number</span><span style=color:#111>,</span>
  <span style=color:#75af00>word</span>: <span style=color:#00a8c8>string</span><span style=color:#111>,</span>
  <span style=color:#75af00>status?</span>: <span style=color:#00a8c8>Status</span><span style=color:#111>,</span>
  <span style=color:#75af00>translations</span>: <span style=color:#00a8c8>Array</span><span style=color:#111>&lt;</span><span style=color:#f92672>Translation</span><span style=color:#111>&gt;,</span>
  <span style=color:#75af00>languageId?</span>: <span style=color:#00a8c8>string</span>
<span style=color:#111>};</span>
</code></pre></div><p>The type <code>UserWord</code> has 5 properties with predefined types. So if, for example, we tried to add a <code>languageId</code> that was a number, we would immediately
be warned by the compiler that the wrong type had been added. An even better example is the <code>translations</code> property, which takes an array of <code>Translation</code> type objects. If we tried to add something to the array that was not of type <code>Translation</code>, we would again be warned by the compiler.</p>
<p>Another useful feature is that if you try to add a property that has not been declared on the type, for example <code>language</code>, the compiler would warn you that the property <code>language</code> does not exist on type <code>UserWord</code>.</p>
<p>The warnings given by the compiler and even by our IDE of choice, VSCode, were invaluable in alerting us to type-related bugs before the code was even run.
Over the course of development, this saved us a significant time and frustration as far fewer errors made it into the codebase. Even errors as simple as misspelled variables are caught by the TypeScript compiler.</p>
<h4 id=code-readability>Code readability</h4>
<p>TypeScript greatly increases the readability of our code. Let&rsquo;s take a function that takes an object as a parameter. In JavaScript, you would have to be familiar with that object and its properties, or possibly log the object to the console to see what properties exist on the object. With TypeScript in VSCode, you can simply over the mouse over the type declaration to see a list of the properties that object will have as well as the types of each of those properties.</p>
<p>This means that in future, if more developers join our project, it will be much easier for them to get up to speed on with our codebase. This also results in increased code stability, as you can be sure exactly what properties an object will have, or whether a certain variable is possibly null.</p>
<h4 id=easy-refactoring>Easy refactoring</h4>
<p>TypeScript makes refactoring much easier. For example, if you change a function&rsquo;s name, but forget to change the name in another file, the TypeScript compiler will immediately alert you to the issue, even showing you the exact file and line of code where the problem resides. This means that you can refactor with confidence, resulting in a cleaner codebase.</p>
<h4 id=future-advantages>Future advantages</h4>
<p>All of this means that as the codebase grows and more developers join the project, it will be easier for them to get up to speed, and the codebase will be more stable.</p>
<h4 id=disadvantages-of-typescript>Disadvantages of TypeScript</h4>
<p>Of course, nothing is perfect. Some of the disadvantages of TypeScript include:</p>
<p>Longer code. Using TypeScript involves writing more code than with JavaScript, meaning that writing the code can take longer than with just plain JavaScript.</p>
<p>Having to learn TypeScript. As I mentioned above, none of us had any real experience with TypeScript before beginning this project, so learning TypeScript on top of designing and coding the app resulted in longer development time, especially in the beginning stages. Thankfully, having a strong base in JavaScript made this process much easier.</p>
<p>TypeScripts static typing is not true static typing. Once TypeScript is compiled, it is transpiled into untyped Javascript, meaning that there is still a small risk of type problems at runtime.</p>
<h4 id=conclusion>Conclusion</h4>
<p>Overall, we felt that the benefits clearly outweighted the disadvantages for our usecase. It was worth putting in the extra effort of using TypeScript as it helped us catch bugs before the code was run, meaning that they didn&rsquo;t make it into production. The added readability and easy refactoring made TypeScript the clear winner.</p>
<h3 id=postgresql>PostgreSQL</h3>
<h3 id=react>React</h3>
<p>There are many options available for creating modern websites, so why did we decide to use React for our app?</p>
<p>Our app more resembles a modern interactive app than a static website as it involves a lot of user interaction, so we ruled out static serving of HTML and CSS. We looked into using templating engines such as Handlebars, but for our use case we found that due to the complexity of the user interaction and the level of interactivity we required, something like React would be far better.</p>
<p>Templating engines like handlebars are good for server-side rendering, but they are not good for fast incremental updates of the DOM, event-handling or frontend to backend communication.</p>
<p>In the end we decided on React due to the many advantages that it brought:</p>
<p>The component-based design. Being able to design components that hold state was fundamental to the design of our app. For example, as each &ldquo;word&rdquo; can have it&rsquo;s own state (translation, learning stage, context, etc), React&rsquo;s implementation of hooks and component state fit perfectly with what we had in mind.</p>
<p>Speed. When a user changes a word&rsquo;s state, the result is displayed immediately on the DOM (In this case, the word would be highlighted and it&rsquo;s translation and context would be saved to the word&rsquo;s state).</p>
<h3 id=recoil>Recoil</h3>
<h3 id=heroku--netlify>Heroku + Netlify</h3>
</div>
</section>
<section class=page id=database-api>
<h1>
<a href=#database-api>Database and API design</a>
</h1>
<div class=content>
<p>With the technical decisions settled, it was time to design to vital aspects of the backend architecture: the database and the API.</p>
<p>While a database of some form would always have been necessary, exposing an API was the result of going with a single page React app that talks to the server via API calls. This also opens the door for alternative front ends at a later stage - a mobile app could use the same back end. It is also in keeping with Alexandria being an open source project and allows for a decoupled contributions to front end or back end.</p>
<h3 id=database-architecture>Database architecture</h3>
<p>The basic idea behind the database design was to keep the main tables small and self contained, and work with references (foreign keys) to establish connections where possible in order to normalize the database.</p>
<h4 id=normalization>Normalization</h4>
<p>To normalize a database means to organize or structure it in a way that avoids redundancy of data, undesirable dependencies, and inconsistencies.</p>
<p>In his <a href=https://forum.thethirdmanifesto.com/wp-content/uploads/asgarosforum/987737/00-efc-further-normalization.pdf>paper</a> &ldquo;Further Normalization of the Data Base Relational Model&rdquo;, <a href=https://en.wikipedia.org/wiki/Edgar_F._Codd>Edgar F. Codd</a>, the &ldquo;father&rdquo; of the relational database model, listed these objectives of nomalization:</p>
<ol>
<li><em>To free the collection of relations from undesirable insertion, update and deletion dependencies.</em></li>
<li><em>To reduce the need for restructuring the collection of relations, as new types of data are introduced, and thus increase the life span of application programs.</em></li>
<li><em>To make the relational model more informative to users.</em></li>
<li><em>To make the collection of relations neutral to the query statistics, where these statistics are liable to change as time goes by.</em></li>
</ol>
<p>The following set of tables serves as an example for a database structure that is not properly normalized.</p>
<h6 id=table-1>Table 1:</h6>
<table>
<thead>
<tr>
<th>username</th>
<th>word</th>
<th>word_language</th>
<th>translation</th>
<th>translation_language</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mark</td>
<td>hause</td>
<td>en</td>
<td>Haus</td>
<td>de</td>
</tr>
<tr>
<td>Dana</td>
<td>hause</td>
<td>en</td>
<td>maison</td>
<td>fr</td>
</tr>
<tr>
<td>Eamon</td>
<td>casa</td>
<td>es</td>
<td>house</td>
<td>en</td>
</tr>
</tbody>
</table>
<h6 id=table-2>Table 2:</h6>
<table>
<thead>
<tr>
<th>id</th>
<th>username</th>
<th>email</th>
<th>is_admin</th>
</tr>
</thead>
<tbody>
<tr>
<td>1001</td>
<td>Dana</td>
<td><a href=mailto:dana@email.com>dana@email.com</a></td>
<td>true</td>
</tr>
<tr>
<td>1002</td>
<td>Eamon</td>
<td><a href=mailto:eamon@email.com>eamon@email.com</a></td>
<td>true</td>
</tr>
<tr>
<td>1003</td>
<td>Mark</td>
<td><a href=mailto:marc@email.com>marc@email.com</a></td>
<td>false</td>
</tr>
</tbody>
</table>
<p>The first table holds values of four key entities of Alexandria: <code>users</code>, <code>words</code>, <code>translations</code>, and <code>languages</code>. The second table is the <code>users</code> table to go with it.</p>
<p>There are two independent <code>username</code> columns, an example of redundancy that can lead to so-called &ldquo;update anomalies&rdquo;: It turns out that Marc is not spellt with a &ldquo;k&rdquo; but with a &ldquo;c&rdquo;. If we only change this in the <code>users</code> table, the data will become inconsistent, because it still says &ldquo;Mark&rdquo; in the first table. It is the same situation with the word &ldquo;house&rdquo; that was misspelled as &ldquo;hause&rdquo;. It, too, needs to be updated in too places at once.</p>
<h5 id=normal-forms>Normal forms</h5>
<p>Normalization of relational databases is guided by a set of rules that build on each other. They are calle &ldquo;normal forms&rdquo;.</p>
<h4 id=tables-more-tables-no-sorry-fewer-tables-again>Tables. More tables! No, sorry, fewer tables again.</h4>
<p>We started out with a couple of fairly basic design. This is the graphical representation of one the first drafts:</p>
<p><img src=/images/database-design-marc-1.0.png alt></p>
<p>But as we let our imagination run wild the demand for tables and table columns grew in line with our feature list. &ldquo;Hey, wouldn&rsquo;t it be nice if the user could choose from other users' translations?&rdquo;, or &ldquo;I think every time an existing translation is applied, it should save a new context.&rdquo;, or &ldquo;Will users be able to set a preferred web dictionary?&rdquo;.</p>
<p>After a few iterations to allow for more features, especially cross-user content we landed here:</p>
<p><img src=/images/database-design-marc-1.4.png alt></p>
<p>Reality eventually got the better of us and we decided to cut down the feature list to a more manageable size in line with our time table. We focussed on the single user experience with only the basic groundwork laid for cross-user content, simplified the user profile, and significantly simplified context handling.</p>
<p>For the final design we also stripped the connecting tables of their own unique ids, and made the of the foreign key columns (composite keys) the primary keys. This would ensure that the connections are unique and a user cannot have, for example, two statuses for the same word.</p>
<p>This is what we arrived at for the initial release:</p>
<p><img src=/images/database-design-marc-1.10.png alt></p>
<h5 id=main-tables>Main tables</h5>
<table>
<thead>
<tr>
<th>table</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>users</td>
<td>The people using Alexandria. Each user can actively learn one language at a time and translate to one base language. If the language preferences change, previous progress (translations, word statuses) is kept.</td>
</tr>
<tr>
<td>admins</td>
<td>The people adminiteing Alexandria. That would be us for now.</td>
</tr>
<tr>
<td>langauges</td>
<td>The languages that are supported by Alexandria. For the first release, it is a list of ten. What they have in common is their use of a latin-based alphabet (to avoid surprises with our text parser for now) and their being supported by the PostgreSQL text search. A flag representing the language is saved as a unicode character combination to be used in menus across the application.</td>
</tr>
<tr>
<td>texts</td>
<td>The key entity for learning. Texts are currently provided by users through forms, later through URLs and files. Texts default to being priovate which should particularly suit those who learn best by reading state secrets or erotic literature. Public texts, that can be used by every user to study, could be an option for a future release. The database already provides the necessary column.</td>
</tr>
<tr>
<td>words</td>
<td>Translatable entities. Usually single words like <em>cabbage</em>, but also compounds, or phrases, like <em>get up</em> or <em>l&rsquo;hôtel</em>. Each word must be unique within its language. It can have different meanings (translations) but in database terms, each combination of letters must occur only once per language.</td>
</tr>
<tr>
<td>translations</td>
<td>Translations of words can be provided or selected by the users, but they exist independently of the users who created them. The go from the language of the word in question to a target language associated with this specific translation. Translations could also also be automatically generated to seed the database with a language&rsquo;s most common words; another feature for a follow up version.</td>
</tr>
<tr>
<td>webdictionaries</td>
<td>Online resources in which the user can look up a word or phrase. They</td>
</tr>
</tbody>
</table>
<h5 id=connecting-tables>Connecting tables</h5>
<table>
<thead>
<tr>
<th>table</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>users_words</td>
<td>Word statuses for a usr-word combination are &ldquo;learning&rdquo;, familiar", and &ldquo;learned&rdquo;.User dictionaries could be generated using this table.</td>
</tr>
<tr>
<td>users_translations</td>
<td>Every translated word orginates in a text, and the surrounding words from that text form the translation&rsquo;s context. Users have their own contexts for every translation. If the translation is not newly provided but simply selected from previous translations, the current context is saved and connected to selected the translation and user.</td>
</tr>
<tr>
<td>webdictionary_preference</td>
<td>Users can have one favourite dictionary per source language.</td>
</tr>
</tbody>
</table>
<h4 id=naming-things>Naming things</h4>
<p>An useful side effect of designing the database very early in the project was that we had to agree on the names of the entities that we were going to deal with in our code. Eg. what is a word, what is a phrase? (They are actually the same in the database but different for text parsing). Finding that common language was essential for all communication going forward.</p>
<h3 id=resources-and-collections>Resources and collections</h3>
<ul>
<li><strong>Resources</strong> are the individual items (rows) of the main database tables (&ldquo;single noun&rdquo; name, coloured in the graph). Each resource has a unique (integer) id within its table.</li>
<li><strong>Collections</strong> are lists of resources, that can be filtered by criteria such as languages or user.</li>
</ul>
<h3 id=general-api-route-pattern-rules>General API route pattern rules</h3>
<h4 id=basic-access>Basic access</h4>
<ul>
<li>The type of the resource that is queried is always the first part of the route.</li>
<li>This is the case for both individual resources and collections.</li>
<li>Individual resources are accessed by their id.</li>
<li>Data from other resources associated with the queried resource might be sent back as well, but querying those happens on the backend and is not exposed via the API.</li>
<li>Creation, updates and deletion of resources happens via the basic route (ie. without filters).</li>
</ul>
<h5 id=examples>Examples</h5>
<ul>
<li><code>GET /texts/</code> => a collection of all texts</li>
<li><code>GET /texts/38422</code> => the text with id <code>38422</code></li>
<li><code>POST /translations</code> => create a new translation</li>
<li><code>PUT /users</code> => update user data</li>
<li><code>DELETE /texts/38422</code>=> removes text with id <code>22533</code></li>
</ul>
<h4 id=filtering-collections>Filtering collections</h4>
<ul>
<li>If the second part of the route is not an id (ie. not an integer), we are looking for a filtered collection of that resource.</li>
<li>Filters are indicated by a keyword (in singular) and a unique identifier.</li>
<li>Filters can be chained.</li>
<li>Filtering for the logged-in user only requires the <code>user</code> keyword because the id is stored in the active session. The user keyword is always the last in the route.</li>
</ul>
<h5 id=examples-1>Examples</h5>
<ul>
<li><code>GET /translations/word/22533</code> => all translations (to all languages) for word with id <code>22533</code></li>
<li><code>GET /translations/language/de/word/22533</code> => all translations to German (unique identifier <code>de</code>) for word with id <code>22533</code></li>
<li><code>GET /words/text/38422/user</code> => all words in text <code>38422</code> that the user already has marked.</li>
<li><code>GET /texts/user</code> => all texts belonging to the current user</li>
<li><code>GET /texts/language/fr/user</code> => all texts in French (unique identifier <code>de</code>) belonging to the current user</li>
</ul>
</div>
</section>
<section class=page id=challenges>
<h1>
<a href=#challenges>Challenges and Solutions</a>
</h1>
<div class=content>
<p>What challenges we faced and how we solved them.</p>
<h3 id=parsing-the-text-for-words-and-phrases>Parsing the text for words and phrases</h3>
<h3 id=getting-the-most-out-of-postgresql>Getting the most out of PostgreSQL</h3>
<h3 id=creating-the-ui-for-selecting-phrases>Creating the UI for selecting phrases</h3>
</div>
</section>
<section class=page id=team>
<h1>
<a href=#team>Team</a>
</h1>
<div class=content>
<h3 id=dana-chen>Dana Chen</h3>
<h3 id=eamon-ocallaghan>Eamon O&rsquo;Callaghan</h3>
<h3 id=marc-hermann>Marc Hermann</h3>
</div>
</section>
<section class=page id=references>
<h1>
<a href=#references>References</a>
</h1>
<div class=content>
<ol>
<li><a href=https://www.researchgate.net/publication/349255011_Explorations_in_Language_Acquisition_and_Use>https://www.researchgate.net/publication/349255011_Explorations_in_Language_Acquisition_and_Use</a></li>
</ol>
</div>
</section>
</div>
</body>
</html>